{% extends "index.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Vehicle Details{% endblock %}

{% block style %}
<style>
    .title {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 0;
    }
    .content-header-title {
        display: inline-block;
        margin-right: 1px;
        vertical-align: middle;
    }
    .breadcrumb-wrapper {
        display: inline-block;
        vertical-align: middle;
        margin-top: -4px;
    }
    .vehicle-info-card {
        transition: all 0.3s ease;
    }
    .vehicle-info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 24px 0 rgba(34, 41, 47, 0.1);
    }
    .vehicle-image {
        max-height: 200px;
        object-fit: contain;
    }
    .vehicle-detail-label {
        font-weight: 600;
        color: #5e5873;
    }
    .vehicle-detail-value {
        color: #6e6b7b;
    }
    .service-history-item {
        border-left: 3px solid #7367f0;
        padding-left: 1rem;
        margin-bottom: 1rem;
    }
    .service-history-date {
        font-size: 0.85rem;
        color: #b9b9c3;
    }
    .vehicle-spec-icon {
        font-size: 1.2rem;
        margin-right: 0.5rem;
        color: #7367f0;
    }
    .tab-content {
        padding-top: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="app-content content">
    <div class="content-overlay"></div>
    <div class="header-navbar-shadow"></div>
    <div class="content-wrapper container-xxl p-0">
        <div class="content-header row">
            <div class="content-header-left col-md-9 col-12 mb-2">
                <div class="row breadcrumbs-top">
                    <div class="col-12">
                        <h2 class="content-header-title float-start mb-0 title">Vehicles</h2>
                        <div class="breadcrumb-wrapper">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="{% url 'r-home' %}">Home</a></li>
                                <li class="breadcrumb-item"><a href="{% url 'r-prf-vehicles' %}">Vehicles</a></li>
                                <li class="breadcrumb-item active">Vehicle Details</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-header-right text-md-end col-md-3 col-12 d-md-block d-none">
                <div class="mb-1 breadcrumb-right">
                    <a href="{% url 'r-prf-vehicles' %}" class="btn btn-primary waves-effect">
                        <i data-feather="arrow-left" class="me-25"></i>
                        <span>Back to Vehicles</span>
                    </a>
                </div>
            </div>
        </div>
        
        <div class="content-body">
            <!-- Vehicle details start -->
            <section id="vehicle-details">
                <div class="row match-height">
                    <!-- Vehicle Image and Basic Info -->
                    <div class="col-lg-4 col-md-6 col-12">
                        <div class="card vehicle-info-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4 class="card-title mb-0">{{ vehicle.make }} {{ vehicle.model }}</h4>
                                    <div class="badge bg-light-primary">{{ vehicle.status }}</div>
                                </div>
                                
                                <div class="text-center mb-2">
                                    {% if vehicle.image %}
                                    <img src="{{ vehicle.image.url }}" alt="{{ vehicle.make }} {{ vehicle.model }}" class="img-fluid vehicle-image">
                                    {% else %}
                                    <img src="{% static 'images/vehicle-diagram.svg' %}" alt="Vehicle" class="img-fluid vehicle-image">
                                    {% endif %}
                                </div>
                                
                                <div class="vehicle-basic-details">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="vehicle-detail-label">Registration</span>
                                        <span class="vehicle-detail-value">{{ vehicle.registration_number }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="vehicle-detail-label">VIN</span>
                                        <span class="vehicle-detail-value">{{ vehicle.vin }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="vehicle-detail-label">Year</span>
                                        <span class="vehicle-detail-value">{{ vehicle.year }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="vehicle-detail-label">Owner</span>
                                        <span class="vehicle-detail-value">{{ vehicle.owner.name }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    {% if 'edit' in useruiacl.Profile.Vehicles %}
                                    <a href="{% url 'u-prf-vehicles' vehicle.id %}" class="btn btn-outline-primary btn-sm">
                                        <i data-feather="edit" class="me-25"></i>
                                        <span>Edit</span>
                                    </a>
                                    {% endif %}
                                    <a href="#" class="btn btn-outline-success btn-sm" data-bs-toggle="modal" data-bs-target="#scheduleServiceModal">
                                        <i data-feather="calendar" class="me-25"></i>
                                        <span>Schedule Service</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vehicle Specifications -->
                    <div class="col-lg-8 col-md-6 col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Vehicle Specifications</h4>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="details-tab" data-bs-toggle="tab" href="#details" aria-controls="details" role="tab" aria-selected="true">Details</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="service-tab" data-bs-toggle="tab" href="#service" aria-controls="service" role="tab" aria-selected="false">Service History</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="documents-tab" data-bs-toggle="tab" href="#documents" aria-controls="documents" role="tab" aria-selected="false">Documents</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <!-- Details Tab -->
                                    <div class="tab-pane active" id="details" aria-labelledby="details-tab" role="tabpanel">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-1">
                                                    <div class="d-flex align-items-center mb-1">
                                                        <i data-feather="truck" class="vehicle-spec-icon"></i>
                                                        <h5 class="mb-0">Basic Information</h5>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-borderless">
                                                            <tbody>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Make</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.make }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Model</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.model }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Variant</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.variant }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Body Type</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.body_type }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Color</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.color }}</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-1">
                                                    <div class="d-flex align-items-center mb-1">
                                                        <i data-feather="settings" class="vehicle-spec-icon"></i>
                                                        <h5 class="mb-0">Technical Specifications</h5>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table table-borderless">
                                                            <tbody>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Engine</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.engine_type }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Transmission</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.transmission }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Fuel Type</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.fuel_type }}</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Mileage</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.mileage }} km</td>
                                                                </tr>
                                                                <tr>
                                                                    <td class="vehicle-detail-label">Last Service</td>
                                                                    <td class="vehicle-detail-value">{{ vehicle.last_service_date }}</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Service History Tab -->
                                    <div class="tab-pane" id="service" aria-labelledby="service-tab" role="tabpanel">
                                        {% if service_history %}
                                        <div class="service-history">
                                            {% for service in service_history %}
                                            <div class="service-history-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <h5 class="mb-0">{{ service.service_type }}</h5>
                                                    <span class="service-history-date">{{ service.service_date }}</span>
                                                </div>
                                                <p class="mb-0">{{ service.description }}</p>
                                                <div class="d-flex justify-content-between mt-1">
                                                    <span>Mileage: {{ service.mileage }} km</span>
                                                    <span>Cost: ${{ service.cost }}</span>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% else %}
                                        <div class="text-center p-2">
                                            <div class="avatar bg-light-warning avatar-lg">
                                                <span class="avatar-content"><i data-feather="alert-triangle"></i></span>
                                            </div>
                                            <p class="mt-2">No service history available for this vehicle.</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Documents Tab -->
                                    <div class="tab-pane" id="documents" aria-labelledby="documents-tab" role="tabpanel">
                                        {% if documents %}
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Document Name</th>
                                                        <th>Type</th>
                                                        <th>Expiry Date</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for doc in documents %}
                                                    <tr>
                                                        <td>{{ doc.name }}</td>
                                                        <td>{{ doc.type }}</td>
                                                        <td>{{ doc.expiry_date }}</td>
                                                        <td>
                                                            <div class="d-flex">
                                                                <a href="{{ doc.file.url }}" class="btn btn-icon btn-flat-info btn-sm me-1" target="_blank">
                                                                    <i data-feather="eye"></i>
                                                                </a>
                                                                <a href="{{ doc.file.url }}" class="btn btn-icon btn-flat-success btn-sm" download>
                                                                    <i data-feather="download"></i>
                                                                </a>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        {% else %}
                                        <div class="text-center p-2">
                                            <div class="avatar bg-light-warning avatar-lg">
                                                <span class="avatar-content"><i data-feather="file"></i></span>
                                            </div>
                                            <p class="mt-2">No documents available for this vehicle.</p>
                                            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#uploadDocumentModal">
                                                <i data-feather="upload" class="me-25"></i>
                                                <span>Upload Document</span>
                                            </button>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Maintenance Schedule and Reminders -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Maintenance Schedule</h4>
                            </div>
                            <div class="card-body">
                                {% if maintenance_schedule %}
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Service Type</th>
                                                <th>Due Date</th>
                                                <th>Due Mileage</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for schedule in maintenance_schedule %}
                                            <tr>
                                                <td>{{ schedule.service_type }}</td>
                                                <td>{{ schedule.due_date }}</td>
                                                <td>{{ schedule.due_mileage }} km</td>
                                                <td>
                                                    {% if schedule.status == 'Overdue' %}
                                                    <span class="badge bg-light-danger">{{ schedule.status }}</span>
                                                    {% elif schedule.status == 'Due Soon' %}
                                                    <span class="badge bg-light-warning">{{ schedule.status }}</span>
                                                    {% else %}
                                                    <span class="badge bg-light-success">{{ schedule.status }}</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#scheduleServiceModal">
                                                        Schedule
                                                    </button>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                <div class="text-center p-2">
                                    <div class="avatar bg-light-info avatar-lg">
                                        <span class="avatar-content"><i data-feather="calendar"></i></span>
                                    </div>
                                    <p class="mt-2">No maintenance schedule available for this vehicle.</p>
                                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createScheduleModal">
                                        <i data-feather="plus" class="me-25"></i>
                                        <span>Create Schedule</span>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Vehicle details end -->
            
            <!-- Modals -->
            <!-- Schedule Service Modal -->
            <div class="modal fade" id="scheduleServiceModal" tabindex="-1" aria-labelledby="scheduleServiceModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="scheduleServiceModalLabel">Schedule Service</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="mb-1">
                                    <label class="form-label" for="service-type">Service Type</label>
                                    <select class="form-select" id="service-type" name="service_type">
                                        <option value="">Select Service Type</option>
                                        <option value="Oil Change">Oil Change</option>
                                        <option value="Brake Service">Brake Service</option>
                                        <option value="Tire Rotation">Tire Rotation</option>
                                        <option value="Full Service">Full Service</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="mb-1">
                                    <label class="form-label" for="service-date">Preferred Date</label>
                                    <input type="date" class="form-control" id="service-date" name="service_date">
                                </div>
                                <div class="mb-1">
                                    <label class="form-label" for="service-time">Preferred Time</label>
                                    <select class="form-select" id="service-time" name="service_time">
                                        <option value="">Select Time</option>
                                        <option value="09:00">09:00 AM</option>
                                        <option value="10:00">10:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00">12:00 PM</option>
                                        <option value="13:00">01:00 PM</option>
                                        <option value="14:00">02:00 PM</option>
                                        <option value="15:00">03:00 PM</option>
                                        <option value="16:00">04:00 PM</option>
                                    </select>
                                </div>
                                <div class="mb-1">
                                    <label class="form-label" for="service-notes">Additional Notes</label>
                                    <textarea class="form-control" id="service-notes" name="service_notes" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Schedule</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Upload Document Modal -->
            <div class="modal fade" id="uploadDocumentModal" tabindex="-1" aria-labelledby="uploadDocumentModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="uploadDocumentModalLabel">Upload Document</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="mb-1">
                                    <label class="form-label" for="document-name">Document Name</label>
                                    <input type="text" class="form-control" id="document-name" name="document_name">
                                </div>
                                <div class="mb-1">
                                    <label class="form-label" for="document-type">Document Type</label>
                                    <select class="form-select" id="document-type" name="document_type">
                                        <option value="">Select Document Type</option>
                                        <option value="Registration">Registration</option>
                                        <option value="Insurance">Insurance</option>
                                        <option value="Service Record">Service Record</option>
                                        <option value="Warranty">Warranty</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="mb-1">
                                    <label class="form-label" for="document-expiry">Expiry Date (if applicable)</label>
                                    <input type="date" class="form-control" id="document-expiry" name="document_expiry">
                                </div>
                                <div class="mb-1">
                                    <label class="form-label" for="document-file">Upload File</label>
                                    <input type="file" class="form-control" id="document-file" name="document_file">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Upload</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize feather icons
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
        
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}
