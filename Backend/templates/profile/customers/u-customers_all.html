{% extends "index.html" %}

{% load static %}

{% block title %}u-prf-customers{% endblock %}

{% block style %}
<style>
    /* shri */
    .title {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 0;
    }
    .content-header-title {
        display: inline-block;
        margin-right: 1px;
        vertical-align: middle;
    }
    .breadcrumb-wrapper {
    display: inline-block;
    vertical-align: middle;
    margin-top: -4px; /* Adjust as needed */
    }
    .vehicle-card {
        background: linear-gradient(135deg, #CCE4D7, #A9D6C1);
        border-radius: 1rem;
        padding: 1rem;
        color: white;
        margin-bottom: 1rem;
    }
 
    .vehicle-image-wrapper {
        width: 40%;
        padding-top: 40%;
        /* Square box */
        position: relative;
        overflow: hidden;
        border-radius: 1rem;
        background-color: #fff;
    }
 
    .vehicle-image-wrapper img {
        position: absolute;
        top: 0;
        left: 0;
        object-fit: cover;
        width: 100%;
        height: 100%;
    }
 
    .vehicle-info p {
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
        color: #f6f6f8;
    }
 
    .vehicle-thumb:hover {
        transform: scale(1.05);
        transition: 0.3s ease-in-out;
    }
 
    .vehicle-info p strong {
        color: #f1f0f5;
    }
 
    @media (max-width: 768px) {
        .vehicle-card .col-md-4 {
            margin-bottom: 1rem;
        }
    }
</style>
<style>
/* GENERAL TEXT IMPROVEMENTS */
.card-body {
    color: #282129 !important;
    font-weight: 500 !important;
    line-height: 1.6;
}

/* LABELS - Make them darker and more prominent */
.card-body small,
.text-muted {
    color: #2d2d2e !important;
    font-weight: 600 !important;
    font-size: 0.85rem !important;
}

/* VALUES - Ensure bold text is dark enough */
.fw-bold, .font-weight-bold {
    color: #e9ebec !important;
    font-weight: 700 !important;
}

/* LIST ITEMS - Make them more readable */
ul li {
    color: #c3c8cc !important;
    font-size: 0.95rem;
    margin-bottom: 8px;
    line-height: 1.5;
}

ul li b, ul li strong {
    color: #2c3e50 !important;
    font-weight: 600 !important;
}

/* CARD HEADERS - Better contrast */
.card-header {
    color: #635f5f !important;
    background-color: #05589c !important;
    font-weight: 600 !important;
}

.card-header h6,
.card-header .card-title {
    color: #ffffff !important;
    font-weight: 700 !important;
    font-size: 1.1rem !important;
}

/* SECTION TITLES */
h5, h6 {
    color: #121213 !important;
    font-weight: 700 !important;
    font-size: medium !important;
}

/* SPECIFIC CARD BACKGROUNDS FOR BETTER CONTRAST */
.bg-light-info .card-body,
.bg-light-secondary .card-body {
    background-color: #360470 !important;
    color: #e2e3e4 !important;
}

/* BUTTONS - Make text more visible */
.btn {
    font-weight: 600 !important;
    font-size: 0.9rem !important;
}

.btn-outline-success, .btn-outline-dark, .btn-outline-info {
    color: #212529 !important;
    font-weight: 600 !important;
}

/* VEHICLE DETAILS SPECIFIC */
.vehicle-thumb + ul li {
    padding: 4px 0;
    border-bottom: 1px solid #e9ecef;
}

.vehicle-thumb + ul li:last-child {
    border-bottom: none;
}

/* AMC & WARRANTY CARDS */
.bg-light-secondary {
    background-color: #979292 !important;
}
.bg-light-secondary .card-header {
    background-color: #a3a1a1 !important;
    color: #212529 !important;
}
.bg-light-secondary .card-body {
    background-color: #bebaba !important;
}

/* STATUS INDICATORS */
.card-title {
    font-size: 1.05rem !important;
    font-weight: 700 !important;
    color: #34034b !important;
}

/* IMPROVE READABILITY ON MOBILE */
@media (max-width: 768px) {
    .card-body {
        font-size: 0.95rem !important;
    }
    
    ul li {
        font-size: 0.9rem !important;
    }
    
    .card-header {
        font-size: 0.95rem !important;
    }
}

/* ADDITIONAL CONTRAST FIXES */
.text-info {
    color: #0dcaf0 !important;
}

.text-danger {
    color: #dc3545 !important;
}

/* ENSURE ALL TEXT ELEMENTS ARE DARK ENOUGH */
* {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* OVERRIDE ANY LIGHT TEXT */
.card p, .card span, .card div {
    color: inherit !important;
}
/* Gap between Customer Information and Vehicle sections */
/* Add spacing between card header and card body */
.card-header {
    margin-bottom: 0.5rem !important;
    padding-bottom: 1rem !important;
}

.card-body {
    padding-top: 1.5rem !important;
}


</style>
{% endblock %}

{% load custom_filters %}
{% block content %}
<div class="app-content content ">
        <div class="content-overlay"></div>
        <div class="header-navbar-shadow"></div>
        <div class="content-wrapper container-xxl p-0">
            <div class="content-header row">
                <div class="content-header-left col-md-9 col-12 mb-2">
                    <div class="row breadcrumbs-top">
                        <div class="col-12">
                            <h2 class="content-header-title float-start mb-0 title">Customers</h2>
                            <div class="breadcrumb-wrapper">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="{% url 'u-garage-summary' %}">Vehicle Listing</a>
                                    </li>
                                    
                                    <li class="breadcrumb-item active">Customers
                                    </li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="content-header-right text-md-end col-md-3 col-12 d-md-block d-none">
                    <div class="mb-1 breadcrumb-right">
                        <!-- <div class="dropdown">
                            <button class="btn-icon btn btn-success btn-round btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i data-feather="grid"></i></button>
                            <div class="dropdown-menu dropdown-menu-end"><a class="dropdown-item" href="app-todo.html"><i class="me-1" data-feather="check-square"></i><span class="align-middle">Todo</span></a><a class="dropdown-item" href="app-chat.html"><i class="me-1" data-feather="message-square"></i><span class="align-middle">Chat</span></a><a class="dropdown-item" href="app-email.html"><i class="me-1" data-feather="mail"></i><span class="align-middle">Email</span></a><a class="dropdown-item" href="app-calendar.html"><i class="me-1" data-feather="calendar"></i><span class="align-middle">Calendar</span></a></div>
                        </div> -->
                    </div>
                </div>
            </div>
            <div class="content-body ">                                         
                <section  id="u-prf-customers">
                    <div class="d-flex justify-content-between align-items-center mb-50 ">
                        <div class="d-flex align-items-center">
                            <div class="avatar">
                                <img src="{% static 'custom-assets/images/profile-icon.png' %}" width="30" height="30" alt="Avatar">
                            </div>
                            <h4 class="ms-25 mb-0 fs-7">Customer Information</h4>
                        </div>                       
                        <button type="button" class="btn btn-sm btn-outline-info waves-effect" data-bs-toggle="modal" data-bs-target="#u-prf-customers-modal">
                            <i data-feather='edit'></i> Edit Customer
                        </button>   
                        <!-- Update Customers Modal -->
                        <div class="modal fade text-start" id="u-prf-customers-modal" tabindex="-1" aria-labelledby="u-prf-customers-modal-label" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <small class="modal-title" id="u-prf-customers-modal-label">Update Customer</small>
                                        <button type="button" class="btn-close p-50" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="post" action="{% url 'u-prf-customers' customer_obj.id %}">
                                            {% csrf_token %}
                                            <div class="row">                                  
                                                <div class="col-12 col-md-4 mb-1">
                                                    <label class="form-label" for="phone">Phone<span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="phone" value="{{customer_obj.phone}}" pattern="[0-9]{10}" title="Please enter a 10-digit mobile number" required/>
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="name">Name<span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="name" value="{{customer_obj.name}}" required>
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">
                                                    <label class="form-label" for="email">Email</label>
                                                    <div class="input-group">
                                                        <span class="input-group-text">@</span>                                                
                                                        <input type="email" class="form-control trimwhitespace" name="email" value="{{customer_obj.email}}"/>
                                                    </div>
                                                </div> 
                                                <div class="col-12 col-md-6 mb-1">                                                                
                                                    <label class="form-label" for="gst">GST</label>
                                                    <input type="text" class="form-control" name="gst" value="{{customer_obj.gst}}">
                                                </div>   
                                                <div class="col-12 col-md-6 mb-1">
                                                    <label class="form-label" for="pincode">Pincode</label>
                                                    <input type="text" class="form-control" name="pincode" value="{{customer_obj.pincode}}" pattern="[0-9]{6}" title="Please enter a 6-digit pincode" />
                                                </div>
                                                <div class="col-12 mb-1">                                                                
                                                    <label class="form-label" for="address">Address</label>
                                                    <textarea class="form-control" name="address">{{customer_obj.address}}</textarea>
                                                </div>
                                                <div class="col-12 text-end">                                                            
                                                    <button type="submit" class="btn btn-sm btn-success">Submit</button>
                                                </div>
                                            </div>
                                        </form>    
                                    </div>                                                 
                                </div>
                            </div>
                        </div>
                        <!-- Update Customers Modal --> 
                    </div>
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <!-- <div class="card shadow mb-4 responsive-card">                           
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12 col-md-3">                                                            
                                            <ul class="list-style-icons">
                                                <li><b>Name: </b>{{customer_obj.name}}</li>
                                            </ul>
                                        </div>
                                        <div class="col-12 col-md-3">                                                            
                                            <ul class="list-style-icons">
                                                <li><b>Email: </b>{{customer_obj.email}}</li>
                                            </ul>
                                        </div>
                                        <div class="col-12 col-md-3">                                                            
                                            <ul class="list-style-icons">
                                                <li><b>Phone: </b>{{customer_obj.phone}}</li>
                                            </ul>
                                        </div>
                                        <div class="col-12 col-md-3">                                                            
                                            <ul class="list-style-icons">
                                                <li><b>Pincode: </b>{{customer_obj.pincode}}</li>
                                            </ul>
                                        </div>
                                        <div class="col-12">                                                            
                                            <ul class="list-style-icons">
                                                <li><b>Address: </b>{{customer_obj.address}}</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                            <div class="card shadow">
                                <div class="card-header bg-info text-white d-flex align-items-center pd-5" style="height: 60px !important;">
                                    <img src="{% static 'custom-assets/images/profile-icon.png' %}" width="32" class="rounded-circle me-2" alt="Avatar">
                                    <span style="color: #f4f7f5 !important;">Customer Information</span>
                                </div>
                                <div class="card-body">
                                    <div class="row gy-2 md-3 pd-3">
                                    <!-- FIELD LIST -->
                                    <div class="col-md-3"><strong>Name:</strong> {{ customer_obj.name }}</div>
                                    <div class="col-md-3"><strong>Email:</strong> {{ customer_obj.email }}</div>
                                    <div class="col-md-3"><strong>Phone:</strong> {{ customer_obj.phone }}</div>
                                    <div class="col-md-3"><strong>Pincode:</strong> {{ customer_obj.pincode }}</div>
                                    <div class="col-md-12"><strong>Address:</strong> {{ customer_obj.address }}</div>
                                    </div>
                                </div>
                            </div>

                        
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2  shadow-sm rounded bg-light">
                        <div class="d-flex align-items-center">
                            <div class="avatar">
                                <img src="{% static 'custom-assets/images/bike-ride.png' %}" width="30" height="30" alt="Avatar">
                            </div>
                            <h4 class="ms-25 mb-0">Vehicles</h4>
                        </div>                       
                        <button type="button" class="btn btn-sm btn-outline-success waves-effect" data-bs-toggle="modal" data-bs-target="#c-prf-vehicles-modal">
                            <i data-feather='plus-square'></i> Add Vehicle
                        </button>                         
                        <!-- Create Vehicle Modal -->
                        <div class="modal fade text-start" id="c-prf-vehicles-modal" tabindex="-1" aria-labelledby="c-prf-vehicles-modal-label" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <small class="modal-title" id="c-prf-vehicles-modal-label">Create Vehicle</small>
                                        <button type="button" class="btn-close p-50" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="post" id="vehicleForm" action="{% url 'c-prf-vehicles' customer_obj.id %}" enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <div class="row">                                  
                                                <div class="col-12 col-md-4 mb-1">
                                                    <label class="form-label" for="model">Model<span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="model" required/>
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="make">Make</label>
                                                    <input type="text" class="form-control" name="make">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="license_plate_no">License Plate No.</label>
                                                    <input type="text" class="form-control" name="license_plate_no">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="external_bikeid">External Bikeid</label>
                                                    <input type="text" class="form-control" name="external_bikeid">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="registration_no">Registration No.</label>
                                                    <input type="text" class="form-control" name="registration_no">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="year_of_manufacture">Year Of Manufacture</label>
                                                    <input type="text" class="form-control" name="year_of_manufacture" min="1900" placeholder="e.g. 2025" pattern="^(19\\d{2}|20[0-1]\\d|202[0-5])$" title="Enter a valid 4-digit year between 1900 and 2025" maxlength="4" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,4);">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="fuel_type">Fuel Type</label>
                                                    <input type="text" class="form-control" name="fuel_type">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="transmission_type">Transmission Type</label>
                                                    <input type="text" class="form-control" name="transmission_type">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="engine_no">Engine No.</label>
                                                    <input type="text" class="form-control" name="engine_no">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="chassis_no">Chassis No.</label>
                                                    <input type="text" class="form-control" name="chassis_no">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="vin_no">Vin No.</label>
                                                    <input type="text" class="form-control" name="vin_no">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="color">Color</label>
                                                    <input type="text" class="form-control" name="color">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="reg_state">Registration State</label>
                                                    <input type="text" class="form-control" name="reg_state">
                                                </div>
                                                <div class="col-12 col-md-4 mb-1">                                                                
                                                    <label class="form-label" for="reg_exp">Registration Expiry</label>
                                                    <input type="date" class="form-control" name="reg_exp">
                                                </div>
                                                <div class="col-12 mb-1">
                                                    <label class="form-label" for="upload_image">Upload Image</label>
                                                    <input type="file" class="form-control" name="upload_image" id="c-prf-vehicles-img" 
                                                        accept="image/*" 
                                                        onchange="validateImage(['image/jpeg', 'image/png'], 200, 200, 'c-prf-vehicles-img', 'c-prf-vehicles-img-msg', 'c-prf-vehicles-img-subbtn')">
                                                    <small id="c-prf-vehicles-img-msg" class="form-text"></small>
                                                </div>
                                                <div class="col-12 text-end">                                                            
                                                    <button type="submit" class="btn btn-sm btn-success" id="c-prf-vehicles-img-subbtn">Submit</button>
                                                </div>
                                            </div>
                                        </form>    
                                    </div>                                                 
                                </div>
                            </div>
                        </div>
                        <!-- Create Vehicle Modal --> 
                    </div>
                    {% for vehicle in customer_obj.vehicle.all %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-light-warning p-50">
                                    <small style="color: #f4f7f5 !important;">{{vehicle.model}}</small> 
                                    <div class="heading-elements">
                                        <ul class="list-inline mb-0">
                                            <li>
                                                <form action="{% url 'd-prf-vehicles' vehicle.id %}" method="post">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-icon rounded-circle btn-flat-danger waves-effect" onclick="return confirm('Are you sure you want to delete this vehicle?')">
                                                        <i data-feather='trash-2'></i>
                                                    </button>
                                                </form>
                                            </li>
                                        </ul>
                                    </div>  
                                </div>                            
                                
                                <!-- <div class="card-body">  
                                    <div class="row mt-1">
                                        <div class="col-12 col-md-6">
                                            <div class="card bg-light-info">
                                                <div class="card-header p-50">
                                                    <small>Vehicle info</small> 
                                                    <div class="heading-elements">
                                                        <ul class="list-inline mb-0">
                                                            <li>
                                                                <a data-bs-toggle="modal" data-bs-target="#u-prf-vehicles-modal-{{ vehicle.id }}"><i data-feather='edit'></i></a>
                                                            </li>
                                                        </ul>
                                                    </div>  
                                                </div> 
                                                <div class="card-body">
                                                    <div class="row align-items-center">
                                                        
                                                        <div class="col-md-4">
                                                            <div class="vehicle-image-wrapper text-center">                                                    
                                                                <img class="img-fluid rounded-start vehicle-thumb cursor-pointer"
                                                                    {% if vehicle.image_path %}
                                                                        src="../../../{{vehicle.image_path}}" alt="Vehicle Image"
                                                                    {% else %} 
                                                                        src="{% static 'custom-assets/images/bike-ride.png' %}" alt="Default Image"
                                                                    {% endif %}
                                                                    data-bs-toggle="modal" data-bs-target="#u-prf-vehicles-image-modal-{{ vehicle.id }}" />                                                    
                                                            </div>                                
                                                        </div>                
                                                        <!-- Details --
                                                        <div class="col-md-8">
                                                            <ul>
                                                                <li><b>Chassis No:</b> {{ vehicle.chassis_no }}</li>
                                                                <li><b>Engine No:</b> {{ vehicle.engine_no }}</li>
                                                                <li><b>Vin No:</b> {{ vehicle.vin_no }}</li>
                                                                <li><b>Purchase Date:</b> {{ vehicle.created_at|date:"d M Y" }}</li>
                                                                <li><b>Registration State:</b> {{ vehicle.reg_state }}</li>
                                                                <li><b>Registration Expiry:</b> {% if vehicle.reg_exp %}{{ vehicle.reg_exp }}{% endif %}</li>
                                                                <li><b>Transmission:</b> {{ vehicle.transmission_type }}</li>
                                                                <li><b>Fuel Type:</b> {{ vehicle.fuel_type }}</li>
                                                            </ul>
                                                        </div>                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div> 
                                    </div>
                                    <div class="row match-height">
                                        <div class="col-12 col-md-6">
                                            <div class="mb-25">
                                                <button type="button" class="btn btn-sm btn-outline-dark waves-effect">
                                                    <i data-feather='plus-square'></i> Add AMCs
                                                </button>
                                            </div> 
                                            <div class="card bg-light-secondary">
                                                <div class="card-header">
                                                    <h6 class="card-title">Active</h6>   
                                                    <div class="heading-elements">
                                                        <ul class="list-inline mb-0">
                                                            <li>
                                                                <a class="text-info"><i data-feather='edit'></i></a>
                                                            </li>
                                                            <li>
                                                                <a class="text-danger"><i data-feather='trash-2'></i></a>
                                                            </li>
                                                        </ul>
                                                    </div> 
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <ul>
                                                                <li><b>Start: </b>2023-01-01</li>
                                                                <li><b>End: </b>2024-01-01</li>
                                                                <li><b>Service Center: </b>ABC Motors</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>                                       
                                        <div class="col-12 col-md-6">
                                            <div class="mb-25">
                                                <button type="button" class="btn btn-sm btn-outline-dark waves-effect">
                                                    <i data-feather='plus-square'></i> Add Warranty
                                                </button>
                                            </div> 
                                            <div class="card bg-light-secondary">
                                                <div class="card-header">
                                                    <h6 class="card-title">Valid</h6>   
                                                    <div class="heading-elements">
                                                        <ul class="list-inline mb-0">
                                                            <li>
                                                                <a class="text-info"><i data-feather='edit'></i></a>
                                                            </li>
                                                            <li>
                                                                <a class="text-danger"><i data-feather='trash-2'></i></a>
                                                            </li>
                                                        </ul>
                                                    </div> 
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <ul>
                                                                <li><b>Start: </b>2023-01-10</li>
                                                                <li><b>End: </b>2026-01-10</li>
                                                                <li><b>Coverage: </b>Full</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>                        
                                </div> -->
                                <div class="card-body">  
                                    <!-- Vehicle Information Section -->
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <div class="card shadow-sm border-0">
                                                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-2">
                                                    <h6 class="mb-0 me-2 "><i data-feather="info" class="me-2 shadow-sm"></i>Vehicle Information</h6>
                                                    <a class="btn btn-sm btn-light btn-outline-light" data-bs-toggle="modal" data-bs-target="#u-prf-vehicles-modal-{{ vehicle.id }}">
                                                        <i data-feather='edit'></i>
                                                    </a>
                                                </div> 
                                                <div class="card-body p-3 shadow-sm rounded bg-light">
                                                    <div class="row align-items-center">
                                                        <!-- Vehicle Image -->
                                                        <div class="col-md-4 text-center mb-3 mb-md-0">
                                                            <div class="position-relative">                                                    
                                                                <img class="img-fluid rounded shadow-sm cursor-pointer" 
                                                                    style="max-height: 120px; object-fit: cover;"
                                                                    {% if vehicle.image_path %}
                                                                        src="../../../{{vehicle.image_path}}" alt="Vehicle Image"
                                                                    {% else %} 
                                                                        src="{% static 'custom-assets/images/bike-ride.png' %}" alt="Default Image"
                                                                    {% endif %}
                                                                    data-bs-toggle="modal" data-bs-target="#u-prf-vehicles-image-modal-{{ vehicle.id }}" />
                                                                <div class="position-absolute bottom-0 end-0 mb-1 me-1">
                                                                    <span class="badge bg-info"><i data-feather="zoom-in" width="12"></i></span>
                                                                </div>                                                    
                                                            </div>                                
                                                        </div>                
                                                        <!-- Vehicle Details -->
                                                        <div class="col-md-8">
                                                            <div class="row g-2">
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Chassis No:</small>
                                                                    <div class="fw-bold">{{ vehicle.chassis_no }}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Engine No:</small>
                                                                    <div class="fw-bold">{{ vehicle.engine_no }}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">VIN No:</small>
                                                                    <div class="fw-bold">{{ vehicle.vin_no }}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Purchase Date:</small>
                                                                    <div class="fw-bold">{{ vehicle.created_at|date:"d M Y" }}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Registration State:</small>
                                                                    <div class="fw-bold">{{ vehicle.reg_state }}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Registration Expiry:</small>
                                                                    <div class="fw-bold">{% if vehicle.reg_exp %}{{ vehicle.reg_exp }}{% else %}N/A{% endif %}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Transmission:</small>
                                                                    <div class="fw-bold">{{ vehicle.transmission_type }}</div>
                                                                </div>
                                                                <div class="col-sm-6">
                                                                    <small class="text-muted">Fuel Type:</small>
                                                                    <div class="fw-bold">{{ vehicle.fuel_type }}</div>
                                                                </div>
                                                            </div>
                                                        </div>                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div> 
                                    </div>

                                    <!-- AMC & Warranty Section -->
                                    <div class="row mt-4 g-3">
                                        <!-- AMC Section -->
                                        <div class="col-12 col-lg-6 shadow-sm rounded bg-light">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <h6 class="mb-0"><i data-feather="shield" class="me-1"></i>AMC Plans</h6>
                                                <button type="button" class="btn btn-sm btn-outline-success">
                                                    <i data-feather='plus-square'></i> Add AMC
                                                </button>
                                            </div> 
                                            
                                            <div class="card shadow-sm border-0">
                                                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center py-2">
                                                    <span class=" mb-0 me-2" style="color: #f4f7f5 !important;">Active Plan</span>   
                                                    <div class="d-flex gap-2">
                                                        <a class="btn btn-sm btn-light btn-outline-light">
                                                            <i data-feather='edit' width="14"></i>
                                                        </a>
                                                        <a class="btn btn-sm btn-light btn-outline-light text-danger">
                                                            <i data-feather='trash-2' width="14"></i>
                                                        </a>
                                                    </div> 
                                                </div>
                                                <div class="card-body p-3">
                                                    <div class="row g-2">
                                                        <div class="col-12">
                                                            <small class="text-muted">Start Date:</small>
                                                            <div class="fw-bold">2023-01-01</div>
                                                        </div>
                                                        <div class="col-12">
                                                            <small class="text-muted">End Date:</small>
                                                            <div class="fw-bold">2024-01-01</div>
                                                        </div>
                                                        <div class="col-12">
                                                            <small class="text-muted">Service Center:</small>
                                                            <div class="fw-bold">ABC Motors</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>                                       

                                        <!-- Warranty Section -->
                                        <div class="col-12 col-lg-6 shadow-sm rounded bg-light">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <h6 class="mb-0"><i data-feather="award" class="me-1"></i>Warranty</h6>
                                                <button type="button" class="btn btn-sm btn-outline-info">
                                                    <i data-feather='plus-square'></i> Add Warranty
                                                </button>
                                            </div> 
                                            
                                            <div class="card shadow-sm border-0">
                                                <div class="card-header bg-info text-white d-flex justify-content-between align-items-center py-2">
                                                    <span class="fw-bold" style="color: #f4f7f5 !important;">Valid Coverage</span>   
                                                    <div class="d-flex gap-2">
                                                        <a class="btn btn-sm btn-light btn-outline-light">
                                                            <i data-feather='edit' width="14"></i>
                                                        </a>
                                                        <a class="btn btn-sm btn-light btn-outline-light text-danger">
                                                            <i data-feather='trash-2' width="14"></i>
                                                        </a>
                                                    </div> 
                                                </div>
                                                <div class="card-body p-3">
                                                    <div class="row g-2">
                                                        <div class="col-12">
                                                            <small class="text-muted">Start Date:</small>
                                                            <div class="fw-bold">2023-01-10</div>
                                                        </div>
                                                        <div class="col-12">
                                                            <small class="text-muted">End Date:</small>
                                                            <div class="fw-bold">2026-01-10</div>
                                                        </div>
                                                        <div class="col-12">
                                                            <small class="text-muted">Coverage:</small>
                                                            <div class="fw-bold">Full Coverage</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>                        
                                </div>

                            </div>
                        </div>
                    </div>                                            
                    <!-- Update Vehicle Modal -->
                    <div class="modal fade text-start" id="u-prf-vehicles-modal-{{ vehicle.id }}" tabindex="-1" aria-labelledby="u-prf-vehicles-modal-label-{{ vehicle.id }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <small class="modal-title" id="u-prf-vehicles-modal-label-{{ vehicle.id }}">Update Vehicle</small>
                                    <button type="button" class="btn-close p-50" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form method="post" action="{% url 'u-prf-vehicles' vehicle.id %}">
                                        {% csrf_token %}
                                        <div class="row">                                  
                                            <div class="col-12 col-md-4 mb-1">
                                                <label class="form-label" for="model">Model<span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" name="model" value="{{vehicle.model}}" required/>
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="make">Make</label>
                                                <input type="text" class="form-control" name="make" value="{{vehicle.make}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="license_plate_no">License Plate No.</label>
                                                <input type="text" class="form-control" name="license_plate_no" value="{{vehicle.license_plate_no}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="external_bikeid">External Bikeid</label>
                                                <input type="text" class="form-control" name="external_bikeid" value="{{vehicle.external_bikeid}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="registration_no">Registration No.</label>
                                                <input type="text" class="form-control" name="registration_no" value="{{vehicle.registration_no}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="year_of_manufacture">Year Of Manufacture</label>
                                                <input type="text" class="form-control" name="year_of_manufacture" value="{{vehicle.year_of_manufacture}}" placeholder="e.g. 2025" pattern="^(19\\d{2}|20[0-1]\\d|202[0-5])$" title="Enter a valid 4-digit year between 1900 and 2025" maxlength="4" oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,4);">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="fuel_type">Fuel Type</label>
                                                <input type="text" class="form-control" name="fuel_type" value="{{vehicle.fuel_type}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="transmission_type">Transmission Type</label>
                                                <input type="text" class="form-control" name="transmission_type" value="{{vehicle.transmission_type}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="engine_no">Engine No.</label>
                                                <input type="text" class="form-control" name="engine_no" value="{{vehicle.engine_no}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="chassis_no">Chassis No.</label>
                                                <input type="text" class="form-control" name="chassis_no" value="{{vehicle.chassis_no}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="vin_no">Vin No.</label>
                                                <input type="text" class="form-control" name="vin_no" value="{{vehicle.vin_no}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="color">Color</label>
                                                <input type="text" class="form-control" name="color" value="{{vehicle.color}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="reg_state">Registration State</label>
                                                <input type="text" class="form-control" name="reg_state" value="{{vehicle.reg_state}}">
                                            </div>
                                            <div class="col-12 col-md-4 mb-1">                                                                
                                                <label class="form-label" for="reg_exp">Registration Expiry</label>
                                                <input type="date" class="form-control" name="reg_exp" value="{{vehicle.reg_exp|date:'Y-m-d'}}">
                                            </div>
                                            <div class="col-12 text-end">                                                            
                                                <button type="submit" class="btn btn-sm btn-success">Submit</button>
                                            </div>
                                        </div>
                                    </form>    
                                </div>                                                 
                            </div>
                        </div>
                    </div>
                    <!-- Update Vehicle Modal -->                                      
                    <!-- Update Vehicle Image Modal -->
                    <div class="modal fade text-start" id="u-prf-vehicles-image-modal-{{ vehicle.id }}" tabindex="-1" aria-labelledby="u-prf-vehicles-image-modal-label-{{ vehicle.id }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <small class="modal-title" id="u-prf-vehicles-image-modal-label-{{ vehicle.id }}">Update Vehicle Image</small>
                                    <button type="button" class="btn-close p-50" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body text-center">
                                    <!-- LIVE PREVIEW IMAGE -->
                                    <img class="img-fluid rounded mb-1" 
                                    {% if vehicle.image_path %}
                                        src="../../../{{vehicle.image_path}}" alt="Vehicle Image"
                                    {% else %} 
                                        src="{% static 'custom-assets/images/bike-ride.png' %}" alt="Default Image"
                                    {% endif %}/>
                                    <form method="post" action="{% url 'u-prf-vehicles' vehicle.id %}"  enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="row"> 
                                            <div class="col-12 mb-1">
                                                <input type="file" class="form-control" name="upload_image" id="u-prf-vehicles-img-{{ vehicle.id }}" 
                                                    accept="image/*" required
                                                    onchange="validateImage(['image/jpeg', 'image/png'], 200, 200, 'u-prf-vehicles-img-{{ vehicle.id }}', 'u-prf-vehicles-img-msg-{{ vehicle.id }}', 'u-prf-vehicles-img-subbtn-{{ vehicle.id }}')">
                                                <small id="u-prf-vehicles-img-msg-{{ vehicle.id }}" class="form-text"></small>
                                            </div>
                                            <div class="col-12 text-end">                                                            
                                                <button type="submit" class="btn btn-sm btn-success" id="u-prf-vehicles-img-subbtn-{{ vehicle.id }}">Update Image</button>
                                            </div>
                                        </div>
                                    </form>    
                                </div>                                                 
                            </div>
                        </div>
                    </div>
                    <!-- Update Vehicle Image Modal -->
                    {% empty %} 
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="avatar bg-light-danger avatar-xl">
                                        <span class="avatar-content"><i data-feather='alert-circle'></i></span>
                                    </div>
                                    <p class="card-text fw-bolder">No data available.</p>
                                    <p class="card-text fw-bold">Click on <i data-feather='plus-square'></i> icon to add vehicle for this customer.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {%endfor%} 
                </section>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize feather icons
        feather.replace();  
    
        /**
         * Show toast notification
         * @param {string} type - success, info, warning, error
         * @param {string} message - Message to display
         */
        const showToast = (type, message) => {
            toastr[type](message, type.toUpperCase(), {
                closeButton: true,
                tapToDismiss: false,
                progressBar: true,
                showMethod: 'fadeIn',
                hideMethod: 'fadeOut',
                timeOut: 3000
            });
        };

        //create vehicle for this customer
        const vehicleForm = document.getElementById('vehicleForm');
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        /**
         * Create a new vehicle
         * @param {FormData} formData 
         */
        const handleVehicleCreate = async (formData) => {
            try {
                const response = await fetch(vehicleForm.action, {
                    method: 'POST',
                    headers: { 'X-CSRFToken': csrfToken },
                    body: formData
                });

                const data = await response.json();

                if (data.status) {
                    showToast('success', data.message);

                    // Close and reset modal
                    const vehicleModal = bootstrap.Modal.getInstance(document.getElementById('c-prf-vehicles-modal'));
                    vehicleModal.hide();
                    vehicleForm.reset();
                    setTimeout(() => { location.reload(); }, 3000);
                } else {
                    showToast('error', data.message);
                }
            } catch (error) {
                showToast('error', `Something went wrong: ${error}`);
            }
        };

        // Add new vehicle form submit
        vehicleForm?.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(vehicleForm);
            handleVehicleCreate(formData);
        });

    });
</script>
{% endblock %}